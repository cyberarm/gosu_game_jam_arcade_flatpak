app-id: dev.cyberarm.GosuGameJamArcade
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
command: gosu_game_jam_arcade.sh
modules:
  # # Only needed for ffi-gosu gem
  # - name: gosu
  #   buildsystem: cmake
  #   builddir: true
  #   config-options:
  #     - --D CMAKE_INSTALL_PREFIX:PATH=/usr
  #   sources:
  #     - type: git
  #       url: https://github.com/gosu/gosu
  #       commit: 6a77f17a9274ce1dd835ec9f8e2fd8ed5f4a6927

  - name: ruby
    config-opts:
      - --enable-shared
      - --disable-install-doc
    sources:
      - type: archive
        url: https://cache.ruby-lang.org/pub/ruby/3.0/ruby-3.0.3.tar.gz
        sha256: 3586861cb2df56970287f0fd83f274bd92058872d830d15570b36def7f1a92ac
        x-checker-data:
          type: html
          url: https://www.ruby-lang.org/en/downloads/
          version-pattern: The current stable version is ([\d\.]+)\.
          url-pattern: (https://cache.ruby-lang.org/pub/ruby/[\d\.]+/ruby-[\d\.]+.tar.gz)

  - name: bundler
    buildsystem: simple
    build-commands:
      - gem install --local bundler-2.2.32.gem --no-doc
    sources:
      - type: file
        url: https://rubygems.org/downloads/bundler-2.2.32.gem
        sha256: a5fc106134ce2048fd46b68c10c8d1c296a9006a0ee473da7c5116def4a7fb6a

  # Generated by: https://github.com/flatpak/flatpak-builder-tools/tree/master/rubygems
  - rubygems.json

  - name: gosu_game_jam_arcade
    buildsystem: simple
    build-commands:
      - install -D gosu_game_jam_arcade.sh /app/bin/gosu_game_jam_arcade.sh
      - ls -la /app/bin
      - install -D gosu_game_jam_arcade.rb /app/gosu_game_jam_arcade/gosu_game_jam_arcade.rb
      - install -D Gemfile /app/gosu_game_jam_arcade/Gemfile
      - install -D Gemfile.lock /app/gosu_game_jam_arcade/Gemfile.lock
      - ls -la lib
      - ls -la media
      - cp -r lib/ /app/gosu_game_jam_arcade/
      - cp -r media/ /app/gosu_game_jam_arcade/
    sources:
      - type: file
        path: gosu_game_jam_arcade.sh
      - type: git
        url: https://github.com/cyberarm/gosu_game_jam_arcade
        commit: 73956ebad9da3abb5cc38693f257e95504e21d5b
